# 3Dサッカーマネジメントゲーム - 設計メモ

> 2000年代初頭に開発していた3Dサッカーゲームの基本設計と仕組みのまとめ

## 概要

3D表示で試合が展開されるサッカーマネジメントゲーム。プレイヤーの属性、フォーメーション、戦術に基づいて試合がシミュレートされる。

---

## 1. ポジショニングシステム

### 基本的な仕組み

各プレイヤーには**現在のポジション**と**意図されたポジション**が割り当てられる。

### ポジション決定要素

- **フォーメーション**: 4-4-2、4-3-3など
- **選択された戦術**: 守備的、攻撃的、ロングパスなど
- **ボールの位置**: ピッチ上のボールの現在位置
- **試合の状況**: スコア、残り時間など

### 具体例

- **4-4-2フォーメーション + 守備的戦術**  
  → 選手はゴールに近いポジションを取る

- **ロングパス戦術**  
  → フォワードは相手ゴールに向かって前進

- **基本動作**  
  フォーメーションに基づくデフォルトポジションがあり、様々な要素で調整される

---

## 2. 意図（Intent）システム

### 意図とは

プレイヤーの当面の目標を大まかに示すもの。

### 意図の種類

- 守備
- タックル
- インターセプト
- シュート
- 待機（ボールが近くにない場合）
- マーキング

### 意図決定のロジック

**決定木ベース**でプレイヤー/ボールの位置、戦術、試合状況などに基づいて決定。

#### 具体例

**シナリオ**: ハーフラインからゴールに向かって走っている攻撃者がいる

**ディフェンダーの意図決定**:
1. まず選手/ボールに向かって走る
2. タックル/インターセプトを試みる
3. マーキングプレイが選択されている場合は他の選手をマークする

### 特徴

- 可能な限り多くのシナリオをカバーするための大量のロジック
- 各意図は**他のプレイヤーとは独立して計算**される（後述の課題に関連）

---

## 3. アニメーションシステム

### アニメーション選択方法

**現在の意図**と**希望する意図**に基づいてアニメーションを選択。

### データ構造

アニメーションはテーブルとして保存:
- 開始アニメーション
- 希望するアニメーション
- 状態間を移動するための中間アニメーション

### 制約と課題

- **ブレンディングなし**: アニメーション間の補間がない
- たまに変なポーズになることがあった
- それでもまあまあ見栄えは良かった

---

## 4. 結果計算システム

### 計算タイミング

ボールが蹴られた（またはスローインで投げられた）瞬間に、**結果を即座に計算**。

### 計算要素

- プレイヤーの属性（シュート能力、タックル能力など）
- 相手プレイヤーの属性（ゴールキーパーの評価など）

### 具体例

#### シュートの場合

**条件**: 
- プレイヤーが高いシュート属性を持つ
- ゴールキーパーの評価が低い

**結果**: 
- ゴールになる可能性が高い
- 物理コードがボールをゴールに運ぶ

#### セーブの場合

**処理**:
1. シュートがセーブされたと計算
2. ボールとゴールキーパーのアニメーションの軌道を調整
3. ボールがゴールキーパーの手元に収まるようにする

#### タックル・インターセプト

同じプロセスで成功/失敗を判定。

---

## 5. 物理とアニメーションの制御

### ボールコンタクト

ボールコンタクトのタイミングはアニメーションに保存されている。

### 制御の切り替え

#### 物理制御
- ボールが空中にある時
- パス、シュートの軌道

#### アニメーション制御
- ボールがプレイヤーの直接的なコントロール下にある時
  - ドリブル
  - ゴールキーパーがボールを掴む
  - スローイン

### 副作用

アニメーションエンジンにブレンディングがないため、時々**プレイヤーが滑る**のが目立った。

---

## 6. 課題と改善の余地

### 最大の課題: チームとしてのまとまりの欠如

**問題点**:
- 11人の選手が同じ方向を向いているだけ
- 11人の選手が一緒にプレイしているような**まとまりのあるチーム**ではなかった

### 根本原因

**他のプレイヤーとのロジック的な相互作用がなかった**

- 各意図は他のプレイヤーとは独立して計算
- プレイヤー同士が互いに影響し合わなかった

### 未実装の要素

チームメイト間の連携や相互作用のシステムは探求したかったが、**ゲームがキャンセル**されたため実装できなかった。

---

## 総評

全体的にまあまあのゲームだったが、改善の余地は多くあった。特にチームプレイの実装が今後の課題として残された。

---

## 今後の開発への示唆

このメモから得られる教訓:

1. **意図システムの独立性**: 各プレイヤーの意図を他のプレイヤーと連携させる仕組みが必要
2. **チーム戦術の実装**: フォーメーション維持、スペースの使い方、連携プレイ
3. **アニメーションブレンディング**: より滑らかな動きの実現
4. **リアルタイムフィードバック**: 計算結果とビジュアルの整合性を高める
