# Soccer Simulation Digest - Architecture Plan

## 1. システム概要

### 何を作るか
選手パラメータからサッカーの試合をシミュレーションし、結果を**ダイジェスト再生**で見せるシステム。

### コアコンセプト

```
【ピリオド制シミュレーション】
- 1分 = 12ピリオド（5秒1ピリオド、90分なら1080ピリオド）
- 各ピリオドでボール保持者が1回行動
- 全選手が評価に基づいてポジション移動

【グリッドベース】
- ピッチを 10×7 グリッド（縦10×横7 = 70マス）に分割
- 1マス ≒ 10m（ピッチ: 約100m × 70m）
- 選手・ボールはグリッド座標で管理
- 移動・パスはグリッド単位（ロングパス = 4〜5グリッド先、など）
```

### 1ピリオドの流れ

```
1. 全選手が「次に行きたい位置」を決定（意図のみ、まだ動かない）
2. ボール保持者が行動決定（パス / ドリブル / シュート）
   - パス先を選ぶ時、味方の「現在位置」を参照
   - 将来的には「意図位置」へのスルーパスも実装可能
3. 行動の成否判定（選手パラメータで確率計算）
4. 全選手がポジション移動（意図位置へ）
5. ピリオド結果をログに記録
6. 次のピリオドへ
```

---

## 2. 行動ロジック

### ボール保持者（何をするか）

```
優先度順に判定:

1. シュート可能？
   - ゴールから3グリッド以内
   - 成功率 = 基本40% + (Shoot × 0.5) - (GK能力 × 0.3)

2. パス先がある？
   - 味方の「受け手スコア」を計算
   - 最もスコアが高い味方へパス
   - 成功率 = 基本70% + (Pass × 0.3) - (距離ペナルティ)

3. ドリブルできる？
   - 前方グリッドに敵がいなければ1マス前進
   - 敵がいる場合 → 突破成功率を計算

4. どれもダメ
   - バックパス or キープ
```

### ボール非保持者（どこに動くか）

```
【攻撃側】グリッド評価で最適位置へ移動
- ゴールに近い → 加点
- 敵から遠い → 加点
- パスコースが通る → 加点

【守備側】
- マーク対象に近づく
- または危険なスペースを埋める
```

---

## 3. 選手パラメータと影響度

| パラメータ | 影響する行動 |
|-----------|-------------|
| **Speed** | 1ピリオドで移動できるグリッド数 |
| **Shoot** | シュート成功率に加算 |
| **Pass** | パス成功率に加算 |
| **Dribble** | ドリブル突破成功率、敵に奪われにくさ |

---

## 4. 実装ロードマップ

### Phase 1: 基盤
- [ ] グリッド座標系の定義
- [ ] PlayerAgent, Ball, Team クラス作成
- [ ] 11vs11 をグリッド上に配置

### Phase 2: ピリオド処理
- [ ] 1ピリオドのループ処理
- [ ] パス/ドリブル/シュートの成否判定
- [ ] ピリオドログの記録

### Phase 3: ポジショニング
- [ ] グリッド評価関数の実装
- [ ] 攻撃側の走り込み
- [ ] 守備側のマーク・カバー

### Phase 4: 試合フロー
- [ ] キックオフ、ゴール後の処理
- [ ] 前半/後半の切り替え

### Phase 5: ダイジェスト再生
- [ ] ログデータから座標を再生
- [ ] 再生UI（シークバー、速度変更）

---

## 5. データ構造

### ピリオドログ
```csharp
public class PeriodLog
{
    public int Minute;
    public int ActorId;           // 行動した選手
    public ActionType Action;     // Pass, Dribble, Shoot
    public int TargetId;          // パス先 or null
    public bool Success;
    public GridPosition[] AllPositions;  // 全選手の位置
}
```

### グリッド座標
```csharp
public struct GridPosition
{
    public int X;  // 0〜6（横: 7マス）
    public int Y;  // 0〜9（縦: 10マス、ゴール方向）
}
```

---

## 6. 拡張性：介入モード

将来「途中で指示を出す」機能を追加する場合：

```
通常モード:
0分 → 1分 → 2分 → ... → 90分（自動進行）

介入モード:
0分 → ⏸️ → 指示UI → 1分 → ⏸️ → 指示UI → ...

介入の例:
- 「攻撃的に！」→ 攻撃寄りの評価に補正
- 「◯番をマーク」→ 特定選手への守備指示
```

---

## 7. フォルダ構成

```
Assets/Scripts/
├── Simulator/    ← シミュレーション処理（Simulator接頭語）
│   ├── SimulatorMatch.cs       試合全体の管理
│   ├── SimulatorTeam.cs        チーム情報
│   ├── SimulatorPlayer.cs      選手の動き・判断
│   ├── SimulatorBall.cs        ボール状態
│   ├── SimulatorGrid.cs        グリッド評価
│   └── SimulatorDigest.cs      再生処理
│
└── Class/        ← データクラス（接頭語なし）
    ├── PlayerStats.cs          選手パラメータ
    ├── PeriodLog.cs            ピリオドログ
    └── GridPosition.cs         グリッド座標
```
